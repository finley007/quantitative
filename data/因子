传统量价类因子：
威廉因子：
（当前价格 - 前一千个最低价格）/（前一千个最高价格 - 前一千个最低价格）
问题：
1. 是否渐变时间窗？


现货类因子
总委比（前10）
 总委买金额/（总委买金额+总委卖金额）
 总委卖金额 = 叫卖总量 * 加权平均叫卖价
 总委买金额 = 叫买总量 * 加权平均叫买价

总成交量

/*
分红股的收益率均值减去非分红股的收益率均值
大市值收益率均值减去小市值收益率的均值
高成长股的收益率的均值减去低成长股的收益率的均值
*/



截面因子
价差因子：

期现因子


算法：
1. 对单一产品，在主力合约切换日进行拼接，如果某些因子值依赖于之前的交易日的数据则切换到对应的合约计算。之后多个商品再拼接。
|-------------------|---|
                |---|-----------------------|
                  切换日
因子文件结构：
datetime factor1 factor2.... ret1 ret2...
a. 按品种生成因子文件
遍历品种，遍历合约，读取股指k线，如果因子可以完全由股指k线计算则直接按合约计算因子值，拼接的时候考虑主力合约。
如果需要股指或者股票tick数据则加载对应的文件在内存中关联，计算因子值。为了提高计算效率需要对列进行过滤，只用到有用的列，特别是股票的tick数据    
b. 合并因子文件

2. 现货类因子场景分类
现货类因子因为要结合现货数据所以对股指k线在一个时间点上有一对多的关系：

--------------->时间
股指k线---------------- 股票现货 +++++++++++++++++++++++++  | 股票
                                 +++++++++++++++++++++++++  |
                                ++++++++++++++++++++++++++  |
                                                            |
                                                           \|/
三种场景：
a. 截面：因子计算只依赖于单一的时间点，可以直接作groupby
b. 矩阵：因子计算依赖于一段时间，因此在时间轴和股票轴是一个矩阵，这类因子先在时间轴对单个股票进行计算，再在股票轴做合并。需要做跨天处理？-需要扩展到多天的情形
时间轴维度的计算针对单一stock，在enrich_stock_data内实现，如果需要跨天，实现一个缓存，缓存对应天的数据，实现懒加载模式，如果缓存没有命中则重新加载文件。
c. 竞价：这类因子有可能是截面也有可能是矩阵，主要在集合竞价时间段内计算。

3. 现货数据缓存框架
要经常获取现货数据进行计算，用一个专门的数据结构作为现货数据提取接口。
接口实现采用缓存，缓存用已有的第三方缓存框架。

因子测试框架：
功能测试：
1. 测试算子
2. 测试因子
    测试方法：
      逻辑 单元测试
      对比 RSI OBV ADX
平稳性分析
1. 按日计算均值和方差并绘制折线图，生成统计信息
2. 平稳时间序列分析
性能测试
参数调优

问题：
1. 跨合约处理: 见算法1
2. 现货类因子问题
跨天的连续性处理
2022年缺失
给出写现货因子的思路


